{"$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"VMname":{"type":"string"},"computerName":{"type":"string"},"adminUsername":{"type":"string"},"adminPassword":{"type":"SecureString"},"vmSize":{"type":"string"},"Imageid":{"type":"string"},"AvailablitySetName":{"type":"string"},"NetworkInterfaceName":{"type":"string"},"VaultAdminUser":{"type":"string"},"VaultAdminPassword":{"type":"SecureString"},"VaultPrivateIP":{"type":"string"},"Guid":{"type":"string"}},"variables":{},"resources":[{"type":"Microsoft.Compute/virtualMachines","name":"[parameters('VMname')]","apiVersion":"2017-03-30","location":"[resourceGroup().location]","properties":{"osProfile":{"computerName":"[parameters('computerName')]","adminUsername":"[parameters('adminUsername')]","adminPassword":"[parameters('adminPassword')]"},"hardwareProfile":{"vmSize":"[parameters('vmSize')]"},"storageProfile":{"imageReference":{"id":"[parameters('ImageID')]"},"osDisk":{"createOption":"fromImage","managedDisk":{"storageAccountType":"Premium_LRS"}}},"networkProfile":{"networkInterfaces":[{"id":"[resourceId('Microsoft.Network/networkInterfaces', parameters('networkInterfaceName'))]"}]},"availabilitySet":{"id":"[resourceId('Microsoft.Compute/availabilitySets', parameters('AvailablitySetName'))]"}},"dependsOn":[]},{"type":"Microsoft.Compute/virtualMachines/extensions","name":"[concat(parameters('computerName'),'/', 'customscriptpsmp')]","apiVersion":"2015-06-15","location":"[resourceGroup().location]","tags":{"displayName":"config-component-psmp"},"properties":{"publisher":"Microsoft.Azure.Extensions","type":"CustomScript","typeHandlerVersion":"2.0","autoUpgradeMinorVersion":true,"settings":{"skipDos2Unix":false},"protectedSettings":{"commandToExecute":"[concat('/var/tmp/register_and_activation.sh ', parameters('VaultAdminUser'), ' ', parameters('VaultAdminPassword'), ' ',  parameters('VaultPrivateIP'),' ', parameters('Guid'), ' ', parameters('adminUsername'))]","fileUris":[]}},"dependsOn":["[concat('Microsoft.Compute/virtualMachines/', parameters('computerName'))]","[concat('Microsoft.Resources/deployments/', 'GuidGenerator')]"]},{"apiVersion":"2015-01-01","name":"GuidGenerator","type":"Microsoft.Resources/deployments","properties":{"mode":"incremental","templateLink":{"uri":"https://armtemplates.azurewebsites.net/api/NewGuid","contentVersion":"1.0.0.0"}}},{"apiVersion":"2015-01-01","name":"substringer","type":"Microsoft.Resources/deployments","properties":{"mode":"incremental","templateLink":{"uri":"https://armtemplates.azurewebsites.net/api/NewGuid","contentVersion":"1.0.0.0"}}}]}
